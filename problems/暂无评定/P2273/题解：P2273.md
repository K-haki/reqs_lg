~~思维题，应该是黄到绿的题~~

### 情景类比

一个非常神奇的想法是具象化这个问题，把序列看成一列人，交换看成送礼物，最小值就是那个礼物，然后就可以愉快的模拟了。感性理解一下，会发现每次交换和其他数值无关，所以只考虑最小值的位置就可以了。

为方便描述，我们把第一个人称作队长，其他人为队员。比如样例，第三个队员有礼物（最小值）。他会在第二次交换把礼物交给第二个队员，然后第二个队员会在第三次交换把礼物交给队长。第一次交换与礼物无关。

### 从 CE-程序到 MIN-程序

由于给定交换序列不一定是 MIN-程序，所以先考虑把它变成 MIN-程序。即考虑如何增加交换，让队长总能收到任何一个队员的礼物。

令 fif_ifi​ 表示队员 iii 的状态，并给定以下两种状态：

  * 若 fi=0f_i=0fi​=0，说明任何初始情况下，队员 iii 不会扣下礼物。
  * 若 fi=1f_i=1fi​=1，说明存在初始情况下，队员 iii 会扣下礼物。

每个交换操作 CE(i,j)\text{CE(i,j)}CE(i,j) 会修改 fif_ifi​ 和 fjf_jfj​，转移方式按顺序如下：

  * 如果 fj=0f_j=0fj​=0 那么 fif_ifi​ 不改变。（因为队员 iii 可能会扣下其他礼物）
  * 如果 fj=1f_j=1fj​=1 那么令 fi=1f_i=1fi​=1。（因为队员 iii 暂时扣下了队员 jjj 给的礼物）
  * 如果 fj=1f_j=1fj​=1 那么令 fj=0f_j=0fj​=0。（因为队员 jjj 暂时扣下的所有礼物都交给了队员 iii）

模拟完毕后，让队长查一下谁会扣下礼物并 ~~教训这些逆子和~~ 统计答案。感性理解一下，就会发现这是最优的。

### 从 CE-程序到可靠的 MIN-程序

考虑删除 CE(i,j)\text{CE(i,j)}CE(i,j) 的含义，我们就可以注意到队员 jjj 扣下的礼物给出去的可能变小了。特别的，对于队员
jjj 到手的礼物，我们至少需要跟进两个以上的与其他人的交换，好保证这礼物不会扣在自己手里。

令 fif_ifi​ 表示让队员 iii 不扣下礼物所需添加的最少交换次数，有以下三种可能：

  * 若 fi=0f_i=0fi​=0，说明任何交换删除和任何初始情况下，队员 iii 不会扣下礼物，所以不需要添加。
  * 若 fi=1f_i=1fi​=1， **在删除某个交换后** ，存在某初始情况下，队员 iii 会被迫扣下礼物，没有删除交换时他并不会扣下礼物，所以只需要添加一个。
  * 若 fi=2f_i=2fi​=2， **不删除任何交换** ，存在某初始情况下，队员 iii 会扣下礼物，所以需要添加两个，因为任何一个都可能被删除。

对于 CE(i,j)\text{CE(i,j)}CE(i,j) 让队员 jjj 交给队员 iii 礼物，那么必有 fi≥fjf_i\ge
f_jfi​≥fj​。但因为这个交换会让队员 jjj 单向影响队员 iii，得到第一条转移。（无非两种情况，感性理解）

对于 CE(i,j)\text{CE(i,j)}CE(i,j) 让队员 jjj 交给队员 iii 礼物，那么让队员 jjj
不扣下礼物所需添加的最少交换次数减一，得到第二条转移。所以得到以下两条转移。

  * 令 fi=max⁡(fi,fj)f_i=\max(f_i,f_j)fi​=max(fi​,fj​)。这步必须优先。
  * 若 fj>0f_j>0fj​>0，令 fj=fj−1f_j=f_j-1fj​=fj​−1，队员 jjj 下调状态。

实在不明白尝试理解下面拆分的情况。

  * 如果 fj≤fif_j\le f_ifj​≤fi​ 那么 fif_ifi​ 不改变。
  * 如果 fj=1f_j=1fj​=1 且 fi=0f_i=0fi​=0 那么令 fi=1f_i=1fi​=1。（队员 iii 本来不会扣下礼物，现在删除某个交换后，存在某情况让队员 jjj 把扣下的礼物交给了队员 iii）
  * 如果 fj=2f_j=2fj​=2 且 fi<2f_i<2fi​<2 那么令 fi=2f_i=2fi​=2。（无论如何，队员 iii 都会收到队员 jjj 扣下的礼物）
  * 如果 fj=1f_j=1fj​=1 那么令 fj=0f_j=0fj​=0。（在删除某个交换后，某初始情况下，队员 jjj 扣下的礼物交给了队员 iii）
  * 如果 fj=2f_j=2fj​=2 那么令 fj=1f_j=1fj​=1。（在某初始情况下，队员 jjj 扣下的礼物交给了队员 iii，除非这个交换被删除）

模拟完毕后，让队长查一下谁会扣下礼物并 ~~继续教训这些逆子和~~ 统计答案，毕竟让队长督促总比队员互相监督更有效。最优来自于 fif_ifi​ 的定义。

### 参考代码

时空复杂度都是线性的，飞快。

    
    
    #include<cstdio>//P2273 [HNOI2002] 交换
    #include"custom_header/fast_IO.h"
    const int N=1e4+3;
    int seq[N];
    int main(){
    	int n=read(),m=read(),ans=0,a,b;
    	for(int i=2;i<=n;++i)seq[i]=2;
    	for(int i=1;i<=m;++i){
    		a=read(),b=read();
    		if(a>1&&seq[a]<seq[b])seq[a]=seq[b];
    		if(seq[b])--seq[b];
    	}
    	for(int i=1;i<=n;++i)ans+=seq[i];
    	print(ans);
    }
    

